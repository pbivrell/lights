{"ast":null,"code":"import _slicedToArray from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../App.css';import React,{useState,useEffect}from\"react\";import{Stage,Layer}from'react-konva';import Bulb from\"../components/Bulb.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Programming(){function handleFiles(e){var fr=new FileReader();fr.onload=function(){processSequence(fr.result);};if(e.target.files.length>0){fr.readAsArrayBuffer(e.target.files[0]);}}function processSequence(seq){console.log(seq);var bytes=new Uint8Array(seq);console.log(bytes);var nextColors=[];var delay=0;for(var i=0;i<bytes.length;i+=8){if(bytes[i]===0x3&&i===0){var count=bytes[i+2]<<8|bytes[i+1];console.log(\"Count\",count);for(var j=0;j<count;j++){nextColors.push({color:\"rgb(0,0,0)\"});}}else if(bytes[i]===0x1){var r=bytes[i+1];var g=bytes[i+2];var b=bytes[i+3];var index=bytes[i+5]<<8|bytes[i+4];console.log(\"color\",r,g,b,index);nextColors[index]={color:\"rgb(\".concat(r,\",\").concat(g,\",\").concat(b,\")\")};}else if(bytes[i]===0x2){delay+=bytes[i+4]<<24|bytes[i+3]<<16|bytes[i+2]<<8|bytes[i+1];console.log(\"delay\",delay);setTimeout(function(lights){console.log(\"Changed lights\");setLights(lights);},delay,[].concat(nextColors));}}setTimeout(function(){processSequence(seq);},delay);}var _useState=useState([]),_useState2=_slicedToArray(_useState,2),lights=_useState2[0],setLights=_useState2[1];var rows=Math.floor((window.innerWidth-200)/170);var radius=50;var xOffset=120;var yOffset=120;return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",onChange:handleFiles}),/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsx(Stage,{width:window.innerWidth,height:window.innerHeight,children:/*#__PURE__*/_jsx(Layer,{children:lights.map(function(elem,idx){console.log(elem,idx);return/*#__PURE__*/_jsx(Bulb,{x:xOffset+xOffset*(idx%rows),y:yOffset+yOffset*Math.floor(idx/rows),color:elem.color,radius:radius});})})})})]});}export default Programming;","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/containers/programming.js"],"names":["React","useState","useEffect","Stage","Layer","Bulb","Programming","handleFiles","e","fr","FileReader","onload","processSequence","result","target","files","length","readAsArrayBuffer","seq","console","log","bytes","Uint8Array","nextColors","delay","i","count","j","push","color","r","g","b","index","setTimeout","lights","setLights","rows","Math","floor","window","innerWidth","radius","xOffset","yOffset","innerHeight","map","elem","idx"],"mappings":"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","sourcesContent":["import '../App.css';\nimport React, { useState, useEffect } from \"react\";\nimport { Stage, Layer } from 'react-konva';\nimport Bulb from \"../components/Bulb.js\"\n\nfunction Programming () {\n\n\tfunction handleFiles(e) {\n\t\tvar fr=new FileReader();\n\t\tfr.onload=function(){\n\t\t\tprocessSequence(fr.result);\n\t\t}\n\t\t\n\t\tif (e.target.files.length > 0) {\n\t\t\tfr.readAsArrayBuffer(e.target.files[0]);\n\t\t}\n\t}\n\n\n\tfunction processSequence(seq) {\n\t\t\n\t\tconsole.log(seq);\n\n\t\tvar bytes = new Uint8Array(seq);\n\n\t\tconsole.log(bytes);\n\n\t\tlet nextColors = [];\n\t\t\n\t\tlet delay = 0;\n\t\t\t\n\t\tfor (let i=0; i<bytes.length; i+=8) {\n\t\t\tif (bytes[i] === 0x3 && i === 0) {\n\t\t\t\tlet count = (bytes[i+2] << 8) | bytes[i+1];\n\t\t\t\tconsole.log(\"Count\", count);\n\t\t\t\tfor (let j = 0; j < count; j++) {\n\t\t\t\t\tnextColors.push({color: `rgb(0,0,0)`})\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else if (bytes[i] === 0x1) {\n\t\t\t\tlet r = bytes[i+1];\n\t\t\t\tlet g = bytes[i+2];\n\t\t\t\tlet b =  bytes[i+3];\n\t\t\t\tlet index = (bytes[i+5] << 8) | bytes[i+4];\n\t\t\t\tconsole.log(\"color\", r,g,b, index);\n\t\t\t\tnextColors[index] = ({color: `rgb(${r},${g},${b})`})\n\t\t\t}else if (bytes[i] === 0x2) {\n\t\t\t\tdelay += (bytes[i+4] << 24) | (bytes[i+3] << 16) | (bytes[i+2] << 8) | bytes[i+1];\n\t\t\t\tconsole.log(\"delay\", delay);\n\t\t\t\tsetTimeout((lights) => {\n\t\t\t\t\tconsole.log(\"Changed lights\");\n\t\t\t\t\tsetLights(lights);\n\t\t\t\t}, delay,[...nextColors] )\n\t\t\t}\n        }\n\n        setTimeout(() => {\n            processSequence(seq)\n        }, delay)\n\t}\n\n\tconst [lights, setLights] = useState([]);\n\tconst rows = Math.floor((window.innerWidth - 200) / 170);\n\tconst radius = 50;\n\tconst xOffset = 120;\n\tconst yOffset = 120;\n\n\treturn (\n\t<div className=\"App\">\n\t\t<input type=\"file\" name=\"file\" onChange={handleFiles} />\n\t\t<header className=\"App-header\">\n\t\t\t<Stage width={window.innerWidth} height={window.innerHeight}>\n      \t\t\t\t<Layer>\n\t\t\t\t\t{\n\t\t\t\t\t\tlights.map( function(elem, idx) {\n\t\t\t\t\t\t\tconsole.log(elem, idx);\n\t\t\t\t\t\t\treturn <Bulb x={xOffset + (xOffset * (idx % rows))} y={yOffset + (yOffset * Math.floor(idx / rows))} color={elem.color} radius={radius}/>\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n      \t\t\t\t</Layer>\n    \t\t\t</Stage>\n\t\t</header>\n\t</div>\n  \t);\n}\n\n\nexport default Programming;\n"]},"metadata":{},"sourceType":"module"}