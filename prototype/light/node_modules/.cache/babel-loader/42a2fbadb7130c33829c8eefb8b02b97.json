{"ast":null,"code":"import _slicedToArray from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../App.css';import Button from\"react-bootstrap/Button\";import React,{useState}from\"react\";import LightsDetect from\"../components/LightDetect\";import LightsIP from\"../components/LightIP\";import{RgbColorPicker}from\"react-colorful\";import axios from\"axios\";import Spinner from\"react-bootstrap/Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Light(){var _useState=useState({r:200,g:150,b:35}),_useState2=_slicedToArray(_useState,2),color=_useState2[0],setColor=_useState2[1];var _useState3=useState({ip:\"192.168.86.162\",pixels:50}),_useState4=_slicedToArray(_useState3,2),ip=_useState4[0],setIP=_useState4[1];var last=Date.now();function onColorChange(color){var now=Date.now();console.log(color);if(now-last<100){console.log(\"ignoring time\");return;}last=now;setColor(color);var data=generateBinary(color,ip.pixels);var blob=new Blob([data],{type:\"application/octet-stream\"});var bodyFormData=new FormData();bodyFormData.append(\"file\",blob,\"dummy.bin\");console.log(\"http://\".concat(ip,\"/upload\"));axios({method:\"post\",url:\"http://\".concat(ip.ip,\"/upload\"),data:bodyFormData,headers:{\"Content-Type\":\"multipart/form-data\"}}).then(function(response){//handle success\nconsole.log(response);}).catch(function(response){//handle error\nconsole.log(response);});//axios.get(`http://${ip}/color?r=${color.r}&g=${color.g}&b=${color.b}`).catch((resp) => {\n//\tconsole.log(\"TODO\")\n//});\n}function generateBinary(color,pixels){var data=new Uint8Array((2+pixels)*8);var bytes=getInt64Bytes(pixels);var count=bytes[bytes.length-2]<<8|bytes[bytes.length-1];data[0]=0x3;data[1]=bytes[bytes.length-1];data[2]=bytes[bytes.length-2];for(var i=0;i<pixels;i++){var _bytes=getInt64Bytes(i);data[(i+1)*8]=0x1;data[(i+1)*8+1]=color.r;data[(i+1)*8+2]=color.g;data[(i+1)*8+3]=color.b;data[(i+1)*8+4]=_bytes[_bytes.length-1];data[(i+1)*8+5]=_bytes[_bytes.length-2];}data[8+pixels*8]=0x2;data[8+pixels*8+1]=200;data[8+pixels*8+2]=0;data[8+pixels*8+3]=0;data[8+pixels*8+4]=0;console.log(data);return data;}function getInt64Bytes(x){var y=Math.floor(x/Math.pow(2,32));return[y,y<<8,y<<16,y<<24,x,x<<8,x<<16,x<<24].map(function(z){return z>>>24;});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(RgbColorPicker,{color:color,onChange:onColorChange}),/*#__PURE__*/_jsxs(\"p\",{children:[color.r,\", \",color.g,\", \",color.b]})]})});}export default Light;","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/containers/light.js"],"names":["Button","React","useState","LightsDetect","LightsIP","RgbColorPicker","axios","Spinner","Light","r","g","b","color","setColor","ip","pixels","setIP","last","Date","now","onColorChange","console","log","data","generateBinary","blob","Blob","type","bodyFormData","FormData","append","method","url","headers","then","response","catch","Uint8Array","bytes","getInt64Bytes","count","length","i","x","y","Math","floor","map","z"],"mappings":"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","sourcesContent":["import '../App.css';\nimport Button from \"react-bootstrap/Button\";\nimport React, { useState } from \"react\";\nimport LightsDetect from \"../components/LightDetect\";\nimport LightsIP from \"../components/LightIP\";\nimport { RgbColorPicker } from \"react-colorful\";\nimport axios from \"axios\";\nimport Spinner from \"react-bootstrap/Spinner\";\n\nfunction Light () {\n\n  \tconst [color, setColor] = useState({ r: 200, g: 150, b: 35 });\n\tconst [ip, setIP] = useState({ ip: \"192.168.86.162\", pixels: 50 });\n\n\tvar last = Date.now();\n\tfunction onColorChange(color) {\n\n\t\tlet now = Date.now();\n\t\tconsole.log(color);\n\t\tif (now - last < 100) {\n\t\t\tconsole.log(\"ignoring time\");\n\t\t\treturn;\n\t\t}\n\t\tlast = now;\n\t\tsetColor(color);\n\n\t\tlet data = generateBinary(color, ip.pixels);\n                let blob = new Blob([data], {type: \"application/octet-stream\"});\n\n\t\tlet bodyFormData = new FormData();\n\n                bodyFormData.append(\"file\", blob, \"dummy.bin\");\n\t\t\n\t\tconsole.log(`http://${ip}/upload`);\n\n                axios({\n                \tmethod: \"post\",\n                \turl: `http://${ip.ip}/upload`,\n                \tdata: bodyFormData,\n                \theaders: { \"Content-Type\": \"multipart/form-data\" },\n                })\n                .then(function (response) {\n                \t//handle success\n                \tconsole.log(response);\n                })\n                .catch(function (response) {\n                \t//handle error\n                \tconsole.log(response);\n                });\n\n\t\t//axios.get(`http://${ip}/color?r=${color.r}&g=${color.g}&b=${color.b}`).catch((resp) => {\n\t\t//\tconsole.log(\"TODO\")\n                //});\n\t}\n\t\n\t\n\tfunction generateBinary(color, pixels) {\n\t\t\n\t\tlet data = new Uint8Array((2 + pixels) * 8);\n\t\tlet bytes = getInt64Bytes(pixels);\n\n\t\tlet count = (bytes[bytes.length-2] << 8) | bytes[bytes.length-1];\n\t\t\n\t\tdata[0] = 0x3;\n\t\tdata[1] = bytes[bytes.length-1];\n\t\tdata[2] = bytes[bytes.length-2];\n\n\t\tfor (let i = 0; i < pixels; i++) {\n\t\t\tlet bytes = getInt64Bytes(i);\n\t\t \tdata[(i + 1) * 8] = 0x1;\n\t\t\tdata[(i + 1) * 8 + 1] = color.r;\n\t\t\tdata[(i + 1) * 8 + 2] = color.g;\n\t\t\tdata[(i + 1) * 8 + 3] = color.b;\n\t\t\tdata[(i + 1) * 8 + 4] = bytes[bytes.length-1];\n\t\t\tdata[(i + 1) * 8 + 5] = bytes[bytes.length-2];\n\t\t}\n\n\t\tdata[8 + (pixels * 8)] = 0x2;\n\t\tdata[8 + (pixels * 8) + 1] = 200;\n\t\tdata[8 + (pixels * 8) + 2] = 0;\n\t\tdata[8 + (pixels * 8) + 3] = 0;\n\t\tdata[8 + (pixels * 8) + 4] = 0;\n\n\n\t\tconsole.log(data);\n\t\treturn data;\n\n\t}\n\n\tfunction getInt64Bytes(x) {\n  \t\tlet y= Math.floor(x/2**32);\n  \t\treturn [y,(y<<8),(y<<16),(y<<24), x,(x<<8),(x<<16),(x<<24)].map(z=> z>>>24)\n\t}\n\n\n\n\n\n\treturn (\n\t<div className=\"App\">\n\t\t<header className=\"App-header\">\n            <RgbColorPicker color={color} onChange={onColorChange} />\n            <p>{ color.r}, {color.g}, {color.b}</p>\n\t\t</header>\n\t</div>\n  \t);\n}\n\n\nexport default Light;\n"]},"metadata":{},"sourceType":"module"}