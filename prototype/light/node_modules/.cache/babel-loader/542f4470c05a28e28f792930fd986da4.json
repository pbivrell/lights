{"ast":null,"code":"import _objectSpread from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../App.css';import'../index.css';import'./home.css';import'../components/Picker2.css';import Login from\"./login.js\";import Signup from\"./signup.js\";import{displayError}from\"../lib/hooks\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{ToggleButton,ToggleButtonGroup,DropdownButton,Dropdown,ListGroup}from\"react-bootstrap\";import Picker2 from\"../components/Picker2.js\";import AddBulb from\"../res/AddBulb_crop.png\";import Setup from'../containers/setup.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Home(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),setup=_useState2[0],setSetup=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),hubs=_useState4[0],setHubs=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),userData=_useState6[0],setUserData=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),authed=_useState8[0],setAuthed=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),register=_useState10[0],setRegister=_useState10[1];function addBulbToggle(){setSetup(!setup);}function dropDown(e){if(e===\"logout\"){logout();}else if(e===\"settings\"){settings();}}function logout(){axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/user\"),{withCredentials:true}).then(function(resp){setAuthed(false);setUserData({});}).catch(function(e){displayError(e);});console.log(\"logout\");}function settings(){console.log(\"setting\");}function sampleUserData(){return{\"id\":\"ruckens\",\"lights\":[{\"alias\":\"main\",\"id\":\"OriginalLight1\"},{\"alias\":\"main\",\"id\":\"OriginalLight1\"}]};}function getUserData(){console.log(\"Loading\",authed);axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/user\"),{withCredentials:true}).then(function(resp){console.log(\"Test\",resp);loadUserData(resp.data);}).catch(function(e){setAuthed(false);displayError(e);});}function loadUserData(data){setUserData(data);if(data.hubs){data.hubs.forEach(function(v){lookupHub(v.id);});}}function lookupHub(name){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/user/hub/\").concat(name),{withCredentials:true}).then(function(resp){loadHubData(name,resp.data);}).catch(function(e){displayError(e);});}function loadHubData(hub,data){var map=_objectSpread({},hubs);map[hub]=data;setHubs(map);}function renderRegister(){return/*#__PURE__*/_jsx(\"div\",{className:\"Auth\",children:/*#__PURE__*/_jsx(Setup,{})});}function renderAuth(){return/*#__PURE__*/_jsxs(\"div\",{className:\"Auth\",children:[/*#__PURE__*/_jsxs(ToggleButtonGroup,{type:\"checkbox\",value:register,onChange:function onChange(v){return setRegister(!register);},children:[/*#__PURE__*/_jsx(ToggleButton,{id:\"tbg-btn-1\",value:true,children:\"Login\"}),/*#__PURE__*/_jsx(ToggleButton,{id:\"tbg-btn-3\",value:false,children:\"Signup\"})]}),register?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Login\"}),/*#__PURE__*/_jsx(Login,{callback:function callback(){setAuthed(true);}})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Signup\"}),/*#__PURE__*/_jsx(Signup,{callback:function callback(){return setAuthed(true);}})]})]});}function renderPage(){return/*#__PURE__*/_jsxs(\"div\",{className:\"Page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"User\",children:/*#__PURE__*/_jsxs(DropdownButton,{drop:'up',variant:\"secondary\",title:userData.id?userData.id:\"\",size:\"lg\",onSelect:dropDown,children:[/*#__PURE__*/_jsx(Dropdown.Item,{eventKey:\"settings\",children:\"Settings\"}),/*#__PURE__*/_jsx(Dropdown.Divider,{}),/*#__PURE__*/_jsx(Dropdown.Item,{eventKey:\"logout\",children:\"Logout\"})]})}),setup?/*#__PURE__*/_jsx(Setup,{cancel:addBulbToggle}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"ButtonPanel\",children:[hubs?Object.entries(hubs).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return value.lights.map(function(value){return/*#__PURE__*/_jsx(Picker2,{className:\"ButtonItem\",hub:key,name:value});});}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(\"div\",{className:\"Picker\",onClick:addBulbToggle,children:/*#__PURE__*/_jsx(\"img\",{className:\"ButtonImage\",src:AddBulb})})]})]});}useEffect(function(){getUserData();//console.log(sampleUserData().lights);\n//setUserData(sampleUserData());\n},[]);return/*#__PURE__*/_jsx(_Fragment,{children:authed?renderPage():renderAuth()});}export default Home;","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/containers/home.js"],"names":["Login","Signup","displayError","React","useState","useEffect","axios","ToggleButton","ToggleButtonGroup","DropdownButton","Dropdown","ListGroup","Picker2","AddBulb","Setup","Home","setup","setSetup","hubs","setHubs","userData","setUserData","authed","setAuthed","register","setRegister","addBulbToggle","dropDown","e","logout","settings","delete","process","env","REACT_APP_API_URL","withCredentials","then","resp","catch","console","log","sampleUserData","getUserData","get","loadUserData","data","forEach","v","lookupHub","id","name","loadHubData","hub","map","renderRegister","renderAuth","renderPage","Object","entries","key","value","lights"],"mappings":"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","sourcesContent":["import '../App.css';\nimport '../index.css';\nimport './home.css';\nimport '../components/Picker2.css'\nimport Login from \"./login.js\";\nimport Signup from \"./signup.js\";\nimport {displayError} from \"../lib/hooks\";\nimport React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport {ToggleButton, ToggleButtonGroup, DropdownButton, Dropdown, ListGroup} from \"react-bootstrap\";\nimport Picker2 from \"../components/Picker2.js\"\nimport AddBulb from \"../res/AddBulb_crop.png\";\nimport Setup from '../containers/setup.js';\n\nfunction Home() {\n\n\tconst [setup, setSetup] = useState(false);\n\n\tconst [hubs, setHubs] = useState([]);\n\n\tconst [userData, setUserData] = useState({});\n\n\tconst [authed, setAuthed] = useState(true);\n\n\tconst [register, setRegister] = useState(false);\n\n\tfunction addBulbToggle() {\n\t\tsetSetup(!setup);\n\t}\n\n\tfunction dropDown(e) {\n\n\t\tif (e === \"logout\") {\n\t\t\tlogout()\n\t\t}else if(e === \"settings\") {\n\t\t\tsettings()\n\t\t}\n\t}\n\n\tfunction logout() {\n\t\taxios.delete(`${process.env.REACT_APP_API_URL}/user`, {\n\t\t\twithCredentials: true,\n\t\t}).then((resp) => {\n\t\t\tsetAuthed(false);\n\t\t\tsetUserData({});\n\t\t}).catch((e) => {\n\t\t\tdisplayError(e);\n\t\t});\n\t\tconsole.log(\"logout\");\n\t}\n\n\tfunction settings() {\n\t\tconsole.log(\"setting\");\n\t}\n\n\tfunction sampleUserData() {\n\t\treturn {\n\t\t\t\"id\": \"ruckens\",\n\t\t\t\"lights\": [\n\t\t\t\t{\n\t\t\t\t\t\"alias\": \"main\",\n\t\t\t\t\t\"id\": \"OriginalLight1\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"alias\": \"main\",\n\t\t\t\t\t\"id\": \"OriginalLight1\"\n\t\t\t\t}\n\t\t\t],\n\t\t}\n\t}\n\n\tfunction getUserData() {\n\t\t\n\t\tconsole.log(\"Loading\", authed);\n\t\taxios.get(`${process.env.REACT_APP_API_URL}/user`, {\n\t\t\twithCredentials: true,\n\t\t}).then((resp) => {\n\t\t\tconsole.log(\"Test\",resp);\n\t\t\tloadUserData(resp.data);\n\t\t}).catch((e) => {\n\t\t\tsetAuthed(false);\n\t\t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction loadUserData(data) {\n\t\tsetUserData(data);\n\t\t\n\t\tif (data.hubs) {\n\t\t\tdata.hubs.forEach((v) => {\n\t\t\t\tlookupHub(v.id);\n\t\t\t});\n\t\t}\n\n\t}\n\n\tfunction lookupHub(name) {\n\t\taxios.get(`${process.env.REACT_APP_API_URL}/user/hub/${name}`, {\n\t\t\twithCredentials: true,\n\t\t}).then((resp) => {\n\t\t\tloadHubData(name, resp.data);\n\t\t}).catch((e) => {\n\t\t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction loadHubData(hub, data) {\n\n\t\tconst map = {...hubs};\n\t\tmap[hub] = data;\n\t\tsetHubs(map);\n\t}\n\n\tfunction renderRegister() {\n\t\treturn (\n\t\t\t<div className=\"Auth\">\n\t\t\t\t<Setup/>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tfunction renderAuth() {\n\t\treturn (\n\t\t\t<div className=\"Auth\">\n\t\t\t\t<ToggleButtonGroup type=\"checkbox\" value={register} onChange={(v) => setRegister(!register) }>\n      \t\t\t\t\t<ToggleButton id=\"tbg-btn-1\" value={true}>\n      \t\t\t\t\t\tLogin\t\n\t\t\t\t\t</ToggleButton>\n      \t\t\t\t\t<ToggleButton id=\"tbg-btn-3\" value={false}>\n      \t\t\t\t\t\tSignup\n\t\t\t\t\t</ToggleButton>\n    \t\t\t\t</ToggleButtonGroup>\n\t\t\t\t{ register ?\n\t\t\t\t\t<>\n\t\t\t\t\t<h3>Login</h3>\n\t\t\t\t\t<Login callback={ () => {\n\t\t\t\t\t\tsetAuthed(true) \n\t\t\t\t\t}}/>\n\t\t\t\t\t</>\n\t\t\t\t:\n\t\t\t\t\t<>\n\t\t\t\t\t<h3>Signup</h3>\n\t\t\t\t\t<Signup callback={ () => setAuthed(true) }/>\n\t\t\t\t\t</>\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\n\t}\n\n\tfunction renderPage() {\n\t\treturn (\n\t\t\t<div className=\"Page\">\n\t\t\t\t<div className=\"User\">\n\t\t\t      \t\t<DropdownButton\n\t\t\t\t\t\t\n        \t\t\t\t\tdrop={'up'}\n        \t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\ttitle={userData.id ? userData.id : \"\"}\n\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\tonSelect={dropDown}\n      \t\t\t\t\t>\n        \t\t\t\t\t<Dropdown.Item eventKey=\"settings\">Settings</Dropdown.Item>\n        \t\t\t\t\t<Dropdown.Divider />\n        \t\t\t\t\t<Dropdown.Item eventKey=\"logout\">Logout</Dropdown.Item>\n      \t\t\t\t\t</DropdownButton>\n\t\t\t\t</div>\n\t\t\t\t{ setup ? <Setup cancel={addBulbToggle}/> : <></> }\n\t\t\t\t<div className=\"ButtonPanel\">\n\t\t\t\t\t{ hubs ? Object.entries(hubs).map(([key, value])=>{\n\t\t\t\t\t\treturn value.lights.map((value)=>{\n\t\t\t\t\t\t\treturn <Picker2 className=\"ButtonItem\" hub={key} name={value}/>\n\t\t\t\t\t\t});\n\t\t\t\t\t}) : <></>\n\t\t\t\t\t}\n\t\t\t\t\t<div className=\"Picker\" onClick={addBulbToggle}>\n                        \t\t\t<img className=\"ButtonImage\" src={AddBulb}></img>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tuseEffect(() => {\n\t\tgetUserData()\n\t\t//console.log(sampleUserData().lights);\n\t\t//setUserData(sampleUserData());\n\t}, []);\n\n\n\treturn (\n\t\t<>\n\t\t\t{ authed ? \n\t\t\t\trenderPage()\n\t\t\t:\n\t\t\t\trenderAuth()\n\t\t\t}\n\n\t\t</>\n\t);\n}\n\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}