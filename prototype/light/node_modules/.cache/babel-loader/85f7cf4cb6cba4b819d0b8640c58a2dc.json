{"ast":null,"code":"var _jsxFileName = \"/Users/pbivrell/light/light/src/components/Picker2.js\",\n    _s = $RefreshSig$();\n\nimport './Picker2.css';\nimport React, { useState, useEffect } from \"react\";\nimport { HuePicker, AlphaPicker } from 'react-color';\nimport bulb from '../res/Bulb_crop.png';\nimport offbulb from '../res/OffBulb_crop.png';\nimport disconnectedbulb from '../res/DisconnectedBulb_crop.png';\nimport axios from \"axios\";\nimport { displayError } from \"../lib/hooks\";\nimport LightSettings from '../containers/lightsettings.js';\nimport { ToggleButton, ToggleButtonGroup, DropdownButton, Dropdown, ListGroup } from \"react-bootstrap\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Picker2(_ref) {\n  _s();\n\n  let {\n    name,\n    hub\n  } = _ref;\n  const [settings, setSettings] = useState(false);\n  const [light, setLight] = useState({});\n  const [patternMode, setPatternMode] = useState(true);\n  useEffect(() => {\n    getLight();\n  }, []);\n  const [color, setColor] = useState({\n    hsl: {\n      a: 1\n    },\n    rgb: {\n      a: 1\n    },\n    hex: \"\"\n  });\n\n  function settingsCallback() {\n    setSettings(false);\n    getLight();\n  }\n\n  function getLight() {\n    axios.get(`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, {\n      withCredentials: true\n    }).then(resp => {\n      setLight(resp.data);\n      let pattern = resp.data.PatternID.split(\"~\")[1].split(\".\")[0].split(\"-\");\n      console.log(pattern);\n      setColor({\n        rgb: {\n          r: pattern[0],\n          g: pattern[1],\n          b: pattern[2],\n          a: pattern[3] / 100\n        },\n        hex: `rgba(${pattern[0]},${pattern[1]},${pattern[2]},${pattern[3] / 100}`,\n        hsl: {\n          a: pattern[3] / 100\n        }\n      });\n    }).catch(e => {\n      displayError(e);\n    });\n  }\n  /*function pushLight(pushColor) {\n  \tlet data = generateBinary(pushColor, light.Count);\n                 let blob = new Blob([data], {type: \"application/octet-stream\"});\n                 let bodyFormData = new FormData();\n                 bodyFormData.append(\"file\", blob, `${pushColor.r}-${pushColor.g}-${pushColor.b}-${pushColor.a}.bin`);\n                  axios({\n                 \tmethod: \"post\",\n                 \turl: `http://${light.IP}/upload`,\n                 \tdata: bodyFormData,\n                 \theaders: { \"Content-Type\": \"multipart/form-data\" },\n                 })\n                 .then(function (response) {\n                 \tconsole.log(response);\n                 })\n                 .catch(function (response) {\n                 \tdisplayError(response)\n                 });\n  }*/\n\n\n  function pushLight(pushColor) {\n    axios.post(`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, {\n      PatternID: `~${pushColor.r}-${pushColor.g}-${pushColor.b}-${Math.floor(pushColor.a * 100)}.bin`\n    }, {\n      withCredentials: true\n    }).then(resp => {\n      console.log(\"toggled\");\n    }).catch(e => {\n      displayError(e);\n    });\n  }\n\n  function pushToggle(s) {\n    axios.post(`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, {\n      Status: s\n    }, {\n      withCredentials: true\n    }).then(resp => {\n      console.log(\"toggled\");\n    }).catch(e => {\n      displayError(e);\n    });\n  }\n\n  function toggleBulb() {\n    const map = { ...light\n    };\n    map.Status = !map.Status;\n    setLight(map);\n    pushToggle(map.Status);\n  }\n\n  function onColorChange(hue, c) {\n    console.log(c);\n    let hsl = c.hsl;\n    let rgb = c.rgb;\n\n    if (!hue) {\n      hsl.a = color.hsl.a;\n      rgb.a = color.rgb.a;\n    }\n\n    setColor({\n      hsl: hsl,\n      rgb: c.rgb,\n      hex: `rgba(${c.rgb.r},${c.rgb.g},${c.rgb.b},${hsl.a}`\n    });\n    pushLight(c.rgb);\n  }\n\n  function generateBinary(color, pixels) {\n    let data = new Uint8Array((2 + pixels) * 8);\n    let bytes = getInt64Bytes(pixels);\n    let count = bytes[bytes.length - 2] << 8 | bytes[bytes.length - 1];\n    data[0] = 0x3;\n    data[1] = bytes[bytes.length - 1];\n    data[2] = bytes[bytes.length - 2];\n\n    for (let i = 0; i < pixels; i++) {\n      let bytes = getInt64Bytes(i);\n      data[(i + 1) * 8] = 0x1;\n      data[(i + 1) * 8 + 1] = parseInt(color.r * color.a);\n      data[(i + 1) * 8 + 2] = parseInt(color.g * color.a);\n      data[(i + 1) * 8 + 3] = parseInt(color.b * color.a);\n      data[(i + 1) * 8 + 4] = bytes[bytes.length - 1];\n      data[(i + 1) * 8 + 5] = bytes[bytes.length - 2];\n    }\n\n    data[8 + pixels * 8] = 0x2;\n    data[8 + pixels * 8 + 1] = 200;\n    data[8 + pixels * 8 + 2] = 0;\n    data[8 + pixels * 8 + 3] = 0;\n    data[8 + pixels * 8 + 4] = 0;\n    console.log(data);\n    return data;\n  }\n\n  function getInt64Bytes(x) {\n    let y = Math.floor(x / 2 ** 32);\n    return [y, y << 8, y << 16, y << 24, x, x << 8, x << 16, x << 24].map(z => z >>> 24);\n  }\n\n  function dropDown(e) {\n    console.log(\"Dropdown\", e);\n  }\n\n  function renderSettings() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Popup Auth\",\n      children: /*#__PURE__*/_jsxDEV(LightSettings, {\n        light: light,\n        hub: hub,\n        callback: settingsCallback\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 4\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Picker\",\n    children: [settings ? renderSettings() : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ButtonText\",\n      onClick: () => setSettings(!settings),\n      children: light.Alias === \"\" ? light.ID : light.Alias\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 3\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Button\",\n      style: {\n        background: color.hex\n      },\n      onClick: toggleBulb,\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"ButtonImage\",\n        src: light.Status ? bulb : offbulb\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 4\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 3\n    }, this), light.Status ? !patternMode ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(HuePicker, {\n        className: \"ButtonImage\",\n        color: color.hsl,\n        onChangeComplete: c => onColorChange(false, c)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(AlphaPicker, {\n        className: \"ButtonImage\",\n        color: color.hsl,\n        onChangeComplete: c => onColorChange(true, c)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 20\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(DropdownButton, {\n      drop: 'up',\n      variant: \"secondary\",\n      title: \"Select Pattern\",\n      size: \"sm\",\n      onSelect: dropDown,\n      className: \"PatternPicker\",\n      children: [/*#__PURE__*/_jsxDEV(Dropdown.Item, {\n        eventKey: \"christmas\",\n        children: \"Settings\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Dropdown.Item, {\n        eventKey: \"easter\",\n        children: \"Easter\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 4\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 172,\n    columnNumber: 2\n  }, this);\n}\n\n_s(Picker2, \"kOCUU2l7hT32hHIkOyPtVQ6Ym+c=\");\n\n_c = Picker2;\nexport default Picker2;\n\nvar _c;\n\n$RefreshReg$(_c, \"Picker2\");","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/components/Picker2.js"],"names":["React","useState","useEffect","HuePicker","AlphaPicker","bulb","offbulb","disconnectedbulb","axios","displayError","LightSettings","ToggleButton","ToggleButtonGroup","DropdownButton","Dropdown","ListGroup","Picker2","name","hub","settings","setSettings","light","setLight","patternMode","setPatternMode","getLight","color","setColor","hsl","a","rgb","hex","settingsCallback","get","process","env","REACT_APP_API_URL","withCredentials","then","resp","data","pattern","PatternID","split","console","log","r","g","b","catch","e","pushLight","pushColor","post","Math","floor","pushToggle","s","Status","toggleBulb","map","onColorChange","hue","c","generateBinary","pixels","Uint8Array","bytes","getInt64Bytes","count","length","i","parseInt","x","y","z","dropDown","renderSettings","Alias","ID","background"],"mappings":";;;AAAA,OAAO,eAAP;AACA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,aAAvC;AACA,OAAOC,IAAP,MAAiB,sBAAjB;AACA,OAAOC,OAAP,MAAoB,yBAApB;AACA,OAAOC,gBAAP,MAA6B,kCAA7B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,YAAR,QAA2B,cAA3B;AACA,OAAOC,aAAP,MAA0B,gCAA1B;AACA,SAAQC,YAAR,EAAsBC,iBAAtB,EAAyCC,cAAzC,EAAyDC,QAAzD,EAAmEC,SAAnE,QAAmF,iBAAnF;;;;AAEA,SAASC,OAAT,OAA8B;AAAA;;AAAA,MAAb;AAACC,IAAAA,IAAD;AAAOC,IAAAA;AAAP,GAAa;AAE7B,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BnB,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACoB,KAAD,EAAQC,QAAR,IAAoBrB,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACsB,WAAD,EAAcC,cAAd,IAAgCvB,QAAQ,CAAC,IAAD,CAA9C;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACfuB,IAAAA,QAAQ;AACR,GAFQ,EAEN,EAFM,CAAT;AAKE,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoB1B,QAAQ,CAAC;AAAE2B,IAAAA,GAAG,EAAE;AAACC,MAAAA,CAAC,EAAE;AAAJ,KAAP;AAAeC,IAAAA,GAAG,EAAE;AAACD,MAAAA,CAAC,EAAE;AAAJ,KAApB;AAA4BE,IAAAA,GAAG,EAAE;AAAjC,GAAD,CAAlC;;AAEF,WAASC,gBAAT,GAA4B;AAC3BZ,IAAAA,WAAW,CAAC,KAAD,CAAX;AACAK,IAAAA,QAAQ;AACR;;AAED,WAASA,QAAT,GAAoB;AAEnBjB,IAAAA,KAAK,CAACyB,GAAN,CAAW,GAAEC,OAAO,CAACC,GAAR,CAAYC,iBAAkB,aAAYlB,GAAI,UAASD,IAAK,EAAzE,EAA4E;AAC3EoB,MAAAA,eAAe,EAAE;AAD0D,KAA5E,EAEGC,IAFH,CAESC,IAAD,IAAU;AACjBjB,MAAAA,QAAQ,CAACiB,IAAI,CAACC,IAAN,CAAR;AACA,UAAIC,OAAO,GAAGF,IAAI,CAACC,IAAL,CAAUE,SAAV,CAAoBC,KAApB,CAA0B,GAA1B,EAA+B,CAA/B,EAAkCA,KAAlC,CAAwC,GAAxC,EAA6C,CAA7C,EAAgDA,KAAhD,CAAsD,GAAtD,CAAd;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYJ,OAAZ;AACAd,MAAAA,QAAQ,CAAC;AACRG,QAAAA,GAAG,EAAE;AAACgB,UAAAA,CAAC,EAAEL,OAAO,CAAC,CAAD,CAAX;AAAgBM,UAAAA,CAAC,EAAEN,OAAO,CAAC,CAAD,CAA1B;AAA+BO,UAAAA,CAAC,EAAEP,OAAO,CAAC,CAAD,CAAzC;AAA8CZ,UAAAA,CAAC,EAAEY,OAAO,CAAC,CAAD,CAAP,GAAW;AAA5D,SADG;AAERV,QAAAA,GAAG,EAAG,QAAOU,OAAO,CAAC,CAAD,CAAI,IAAGA,OAAO,CAAC,CAAD,CAAI,IAAGA,OAAO,CAAC,CAAD,CAAI,IAAGA,OAAO,CAAC,CAAD,CAAP,GAAW,GAAI,EAF9D;AAGRb,QAAAA,GAAG,EAAE;AAACC,UAAAA,CAAC,EAAEY,OAAO,CAAC,CAAD,CAAP,GAAW;AAAf;AAHG,OAAD,CAAR;AAMA,KAZD,EAYGQ,KAZH,CAYUC,CAAD,IAAO;AACfzC,MAAAA,YAAY,CAACyC,CAAD,CAAZ;AACA,KAdD;AAeA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGC,WAASC,SAAT,CAAmBC,SAAnB,EAA8B;AAC7B5C,IAAAA,KAAK,CAAC6C,IAAN,CACE,GAAEnB,OAAO,CAACC,GAAR,CAAYC,iBAAkB,aAAYlB,GAAI,UAASD,IAAK,EADhE,EAEC;AAAEyB,MAAAA,SAAS,EAAG,IAAGU,SAAS,CAACN,CAAE,IAAGM,SAAS,CAACL,CAAE,IAAGK,SAAS,CAACJ,CAAE,IAAGM,IAAI,CAACC,KAAL,CAAWH,SAAS,CAACvB,CAAV,GAAc,GAAzB,CAA8B;AAA5F,KAFD,EAGC;AAACQ,MAAAA,eAAe,EAAE;AAAlB,KAHD,EAKCC,IALD,CAKOC,IAAD,IAAU;AACfK,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,KAPD,EAQCI,KARD,CAQQC,CAAD,IAAO;AACNzC,MAAAA,YAAY,CAACyC,CAAD,CAAZ;AACP,KAVD;AAWA;;AAED,WAASM,UAAT,CAAoBC,CAApB,EAAuB;AACtBjD,IAAAA,KAAK,CAAC6C,IAAN,CACE,GAAEnB,OAAO,CAACC,GAAR,CAAYC,iBAAkB,aAAYlB,GAAI,UAASD,IAAK,EADhE,EAEC;AAACyC,MAAAA,MAAM,EAAED;AAAT,KAFD,EAGC;AAACpB,MAAAA,eAAe,EAAE;AAAlB,KAHD,EAKCC,IALD,CAKOC,IAAD,IAAU;AACfK,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,KAPD,EAQCI,KARD,CAQQC,CAAD,IAAO;AACNzC,MAAAA,YAAY,CAACyC,CAAD,CAAZ;AACP,KAVD;AAWA;;AAED,WAASS,UAAT,GAAsB;AACrB,UAAMC,GAAG,GAAG,EAAC,GAAGvC;AAAJ,KAAZ;AACcuC,IAAAA,GAAG,CAACF,MAAJ,GAAa,CAACE,GAAG,CAACF,MAAlB;AACApC,IAAAA,QAAQ,CAACsC,GAAD,CAAR;AACdJ,IAAAA,UAAU,CAACI,GAAG,CAACF,MAAL,CAAV;AACA;;AAED,WAASG,aAAT,CAAuBC,GAAvB,EAA4BC,CAA5B,EAA+B;AAE9BnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,CAAZ;AAEA,QAAInC,GAAG,GAAGmC,CAAC,CAACnC,GAAZ;AACA,QAAIE,GAAG,GAAGiC,CAAC,CAACjC,GAAZ;;AAEA,QAAG,CAACgC,GAAJ,EAAS;AACRlC,MAAAA,GAAG,CAACC,CAAJ,GAAQH,KAAK,CAACE,GAAN,CAAUC,CAAlB;AACAC,MAAAA,GAAG,CAACD,CAAJ,GAAQH,KAAK,CAACI,GAAN,CAAUD,CAAlB;AACA;;AACDF,IAAAA,QAAQ,CAAC;AAACC,MAAAA,GAAG,EAAEA,GAAN;AAAWE,MAAAA,GAAG,EAAEiC,CAAC,CAACjC,GAAlB;AAAuBC,MAAAA,GAAG,EAAG,QAAOgC,CAAC,CAACjC,GAAF,CAAMgB,CAAE,IAAGiB,CAAC,CAACjC,GAAF,CAAMiB,CAAE,IAAGgB,CAAC,CAACjC,GAAF,CAAMkB,CAAE,IAAGpB,GAAG,CAACC,CAAE;AAA3E,KAAD,CAAR;AAEAsB,IAAAA,SAAS,CAACY,CAAC,CAACjC,GAAH,CAAT;AACA;;AAGD,WAASkC,cAAT,CAAwBtC,KAAxB,EAA+BuC,MAA/B,EAAuC;AAEtC,QAAIzB,IAAI,GAAG,IAAI0B,UAAJ,CAAe,CAAC,IAAID,MAAL,IAAe,CAA9B,CAAX;AACA,QAAIE,KAAK,GAAGC,aAAa,CAACH,MAAD,CAAzB;AAEA,QAAII,KAAK,GAAIF,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAAL,IAAyB,CAA1B,GAA+BH,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAAhD;AAEA9B,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU,GAAV;AACAA,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU2B,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAAf;AACA9B,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU2B,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAAf;;AAEA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAApB,EAA4BM,CAAC,EAA7B,EAAiC;AAChC,UAAIJ,KAAK,GAAGC,aAAa,CAACG,CAAD,CAAzB;AACC/B,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAX,CAAJ,GAAoB,GAApB;AACD/B,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAV,GAAc,CAAf,CAAJ,GAAwBC,QAAQ,CAAC9C,KAAK,CAACoB,CAAN,GAAUpB,KAAK,CAACG,CAAjB,CAAhC;AACAW,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAV,GAAc,CAAf,CAAJ,GAAwBC,QAAQ,CAAC9C,KAAK,CAACqB,CAAN,GAAUrB,KAAK,CAACG,CAAjB,CAAhC;AACAW,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAV,GAAc,CAAf,CAAJ,GAAwBC,QAAQ,CAAC9C,KAAK,CAACsB,CAAN,GAAUtB,KAAK,CAACG,CAAjB,CAAhC;AACAW,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAV,GAAc,CAAf,CAAJ,GAAwBJ,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAA7B;AACA9B,MAAAA,IAAI,CAAC,CAAC+B,CAAC,GAAG,CAAL,IAAU,CAAV,GAAc,CAAf,CAAJ,GAAwBJ,KAAK,CAACA,KAAK,CAACG,MAAN,GAAa,CAAd,CAA7B;AACA;;AAED9B,IAAAA,IAAI,CAAC,IAAKyB,MAAM,GAAG,CAAf,CAAJ,GAAyB,GAAzB;AACAzB,IAAAA,IAAI,CAAC,IAAKyB,MAAM,GAAG,CAAd,GAAmB,CAApB,CAAJ,GAA6B,GAA7B;AACAzB,IAAAA,IAAI,CAAC,IAAKyB,MAAM,GAAG,CAAd,GAAmB,CAApB,CAAJ,GAA6B,CAA7B;AACAzB,IAAAA,IAAI,CAAC,IAAKyB,MAAM,GAAG,CAAd,GAAmB,CAApB,CAAJ,GAA6B,CAA7B;AACAzB,IAAAA,IAAI,CAAC,IAAKyB,MAAM,GAAG,CAAd,GAAmB,CAApB,CAAJ,GAA6B,CAA7B;AAGArB,IAAAA,OAAO,CAACC,GAAR,CAAYL,IAAZ;AACA,WAAOA,IAAP;AAEA;;AAED,WAAS4B,aAAT,CAAuBK,CAAvB,EAA0B;AACvB,QAAIC,CAAC,GAAEpB,IAAI,CAACC,KAAL,CAAWkB,CAAC,GAAC,KAAG,EAAhB,CAAP;AACA,WAAO,CAACC,CAAD,EAAIA,CAAC,IAAE,CAAP,EAAWA,CAAC,IAAE,EAAd,EAAmBA,CAAC,IAAE,EAAtB,EAA2BD,CAA3B,EAA8BA,CAAC,IAAE,CAAjC,EAAqCA,CAAC,IAAE,EAAxC,EAA6CA,CAAC,IAAE,EAAhD,EAAqDb,GAArD,CAAyDe,CAAC,IAAGA,CAAC,KAAG,EAAjE,CAAP;AACF;;AAED,WAASC,QAAT,CAAkB1B,CAAlB,EAAqB;AACpBN,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBK,CAAxB;AACA;;AAED,WAAS2B,cAAT,GAA0B;AACzB,wBACC;AAAK,MAAA,SAAS,EAAC,YAAf;AAAA,6BACC,QAAC,aAAD;AAAe,QAAA,KAAK,EAAExD,KAAtB;AAA6B,QAAA,GAAG,EAAEH,GAAlC;AAAuC,QAAA,QAAQ,EAAEc;AAAjD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,YADD;AAKA;;AAED,sBACA;AAAK,IAAA,SAAS,EAAC,QAAf;AAAA,eACGb,QAAQ,GAAG0D,cAAc,EAAjB,gBAAsB,qCADjC,eAGC;AAAK,MAAA,SAAS,EAAC,YAAf;AAA4B,MAAA,OAAO,EAAE,MAAIzD,WAAW,CAAC,CAACD,QAAF,CAApD;AAAA,gBAAkEE,KAAK,CAACyD,KAAN,KAAgB,EAAhB,GAAqBzD,KAAK,CAAC0D,EAA3B,GAAgC1D,KAAK,CAACyD;AAAxG;AAAA;AAAA;AAAA;AAAA,YAHD,eAIC;AAAK,MAAA,SAAS,EAAC,QAAf;AAAwB,MAAA,KAAK,EAAE;AAACE,QAAAA,UAAU,EAAEtD,KAAK,CAACK;AAAnB,OAA/B;AAAwD,MAAA,OAAO,EAAE4B,UAAjE;AAAA,6BACC;AAAK,QAAA,SAAS,EAAC,aAAf;AAA6B,QAAA,GAAG,EAAEtC,KAAK,CAACqC,MAAN,GAAerD,IAAf,GAAsBC;AAAxD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,YAJD,EAOGe,KAAK,CAACqC,MAAN,GACD,CAACnC,WAAD,gBACC;AAAA,8BACC;AAAA;AAAA;AAAA;AAAA,cADD,eAEC,QAAC,SAAD;AAAW,QAAA,SAAS,EAAC,aAArB;AAAmC,QAAA,KAAK,EAAEG,KAAK,CAACE,GAAhD;AAAqD,QAAA,gBAAgB,EAAGmC,CAAD,IAAOF,aAAa,CAAC,KAAD,EAAQE,CAAR;AAA3F;AAAA;AAAA;AAAA;AAAA,cAFD,eAGC;AAAA;AAAA;AAAA;AAAA,cAHD,eAIe,QAAC,WAAD;AAAa,QAAA,SAAS,EAAC,aAAvB;AAAqC,QAAA,KAAK,EAAErC,KAAK,CAACE,GAAlD;AAAuD,QAAA,gBAAgB,EAAGmC,CAAD,IAAOF,aAAa,CAAC,IAAD,EAAOE,CAAP;AAA7F;AAAA;AAAA;AAAA;AAAA,cAJf;AAAA,oBADD,gBAQA,QAAC,cAAD;AACC,MAAA,IAAI,EAAE,IADP;AAEC,MAAA,OAAO,EAAC,WAFT;AAGC,MAAA,KAAK,EAAE,gBAHR;AAIC,MAAA,IAAI,EAAC,IAJN;AAKC,MAAA,QAAQ,EAAEa,QALX;AAMC,MAAA,SAAS,EAAC,eANX;AAAA,8BAQC,QAAC,QAAD,CAAU,IAAV;AAAe,QAAA,QAAQ,EAAC,WAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cARD,eASC,QAAC,QAAD,CAAU,IAAV;AAAe,QAAA,QAAQ,EAAC,QAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cATD;AAAA;AAAA;AAAA;AAAA;AAAA,YATC,gBAqBD,qCA5BF;AAAA;AAAA;AAAA;AAAA;AAAA,UADA;AAkCA;;GAjMQ5D,O;;KAAAA,O;AAoMT,eAAeA,OAAf","sourcesContent":["import './Picker2.css';\nimport React, { useState, useEffect } from \"react\";\nimport { HuePicker, AlphaPicker } from 'react-color'\nimport bulb from '../res/Bulb_crop.png';\nimport offbulb from '../res/OffBulb_crop.png';\nimport disconnectedbulb from '../res/DisconnectedBulb_crop.png';\nimport axios from \"axios\";\nimport {displayError} from \"../lib/hooks\";\nimport LightSettings from '../containers/lightsettings.js';\nimport {ToggleButton, ToggleButtonGroup, DropdownButton, Dropdown, ListGroup} from \"react-bootstrap\";\n\nfunction Picker2({name, hub}) {\n\n\tconst [settings, setSettings] = useState(false);\n\tconst [light, setLight] = useState({});\n\tconst [patternMode, setPatternMode] = useState(true);\n\n\tuseEffect(() => {\n\t\tgetLight();\n\t}, [])\n\n\n  \tconst [color, setColor] = useState({ hsl: {a: 1}, rgb: {a: 1}, hex: \"\"});\n\t\n\tfunction settingsCallback() {\n\t\tsetSettings(false);\n\t\tgetLight();\n\t}\n\n\tfunction getLight() {\n\t\t\n\t\taxios.get(`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, {\n\t\t\twithCredentials: true,\n\t\t}).then((resp) => {\n\t\t\tsetLight(resp.data);\n\t\t\tlet pattern = resp.data.PatternID.split(\"~\")[1].split(\".\")[0].split(\"-\");\n\t\t\tconsole.log(pattern);\n\t\t\tsetColor({\n\t\t\t\trgb: {r: pattern[0], g: pattern[1], b: pattern[2], a: pattern[3]/100},\n\t\t\t\thex: `rgba(${pattern[0]},${pattern[1]},${pattern[2]},${pattern[3]/100}`,\n\t\t\t\thsl: {a: pattern[3]/100},\n\n\t\t\t});\n\t\t}).catch((e) => {\n\t\t\tdisplayError(e);\n\t\t});\n\t}\n\n\t/*function pushLight(pushColor) {\n\t\tlet data = generateBinary(pushColor, light.Count);\n                let blob = new Blob([data], {type: \"application/octet-stream\"});\n                let bodyFormData = new FormData();\n                bodyFormData.append(\"file\", blob, `${pushColor.r}-${pushColor.g}-${pushColor.b}-${pushColor.a}.bin`);\n\n                axios({\n                \tmethod: \"post\",\n                \turl: `http://${light.IP}/upload`,\n                \tdata: bodyFormData,\n                \theaders: { \"Content-Type\": \"multipart/form-data\" },\n                })\n                .then(function (response) {\n                \tconsole.log(response);\n                })\n                .catch(function (response) {\n                \tdisplayError(response)\n                });\n\t}*/\n\n\tfunction pushLight(pushColor) {\n\t\taxios.post(\n\t\t\t`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, \n\t\t\t{ PatternID: `~${pushColor.r}-${pushColor.g}-${pushColor.b}-${Math.floor(pushColor.a * 100)}.bin` }, \n\t\t\t{withCredentials: true,}\n\t\t)\n\t\t.then((resp) => {\n\t\t\tconsole.log(\"toggled\");\n\t\t})\n\t\t.catch((e) => {\n        \t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction pushToggle(s) {\n\t\taxios.post(\n\t\t\t`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`,\n\t\t\t{Status: s}, \n\t\t\t{withCredentials: true,}\n\t\t)\n\t\t.then((resp) => {\n\t\t\tconsole.log(\"toggled\");\n\t\t})\n\t\t.catch((e) => {\n        \t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction toggleBulb() {\n\t\tconst map = {...light};\n                map.Status = !map.Status;\n                setLight(map);\n\t\tpushToggle(map.Status);\n\t}\n\n\tfunction onColorChange(hue, c) {\n\n\t\tconsole.log(c);\n\n\t\tlet hsl = c.hsl;\n\t\tlet rgb = c.rgb;\n\n\t\tif(!hue) {\n\t\t\thsl.a = color.hsl.a;\n\t\t\trgb.a = color.rgb.a;\n\t\t}\n\t\tsetColor({hsl: hsl, rgb: c.rgb, hex: `rgba(${c.rgb.r},${c.rgb.g},${c.rgb.b},${hsl.a}`});\n\t\t\n\t\tpushLight(c.rgb);\n\t}\n\t\n\t\n\tfunction generateBinary(color, pixels) {\n\t\t\n\t\tlet data = new Uint8Array((2 + pixels) * 8);\n\t\tlet bytes = getInt64Bytes(pixels);\n\n\t\tlet count = (bytes[bytes.length-2] << 8) | bytes[bytes.length-1];\n\t\t\n\t\tdata[0] = 0x3;\n\t\tdata[1] = bytes[bytes.length-1];\n\t\tdata[2] = bytes[bytes.length-2];\n\n\t\tfor (let i = 0; i < pixels; i++) {\n\t\t\tlet bytes = getInt64Bytes(i);\n\t\t \tdata[(i + 1) * 8] = 0x1;\n\t\t\tdata[(i + 1) * 8 + 1] = parseInt(color.r * color.a) ;\n\t\t\tdata[(i + 1) * 8 + 2] = parseInt(color.g * color.a);\n\t\t\tdata[(i + 1) * 8 + 3] = parseInt(color.b * color.a);\n\t\t\tdata[(i + 1) * 8 + 4] = bytes[bytes.length-1];\n\t\t\tdata[(i + 1) * 8 + 5] = bytes[bytes.length-2];\n\t\t}\n\n\t\tdata[8 + (pixels * 8)] = 0x2;\n\t\tdata[8 + (pixels * 8) + 1] = 200;\n\t\tdata[8 + (pixels * 8) + 2] = 0;\n\t\tdata[8 + (pixels * 8) + 3] = 0;\n\t\tdata[8 + (pixels * 8) + 4] = 0;\n\n\n\t\tconsole.log(data);\n\t\treturn data;\n\n\t}\n\n\tfunction getInt64Bytes(x) {\n  \t\tlet y= Math.floor(x/2**32);\n  \t\treturn [y,(y<<8),(y<<16),(y<<24), x,(x<<8),(x<<16),(x<<24)].map(z=> z>>>24)\n\t}\n\n\tfunction dropDown(e) {\n\t\tconsole.log(\"Dropdown\", e);\n\t}\n\n\tfunction renderSettings() {\n\t\treturn (\n\t\t\t<div className=\"Popup Auth\">\n\t\t\t\t<LightSettings light={light} hub={hub} callback={settingsCallback}/>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t<div className=\"Picker\">\n\t\t{ settings ? renderSettings() : <></>}\n\n\t\t<div className=\"ButtonText\" onClick={()=>setSettings(!settings)}>{light.Alias === \"\" ? light.ID : light.Alias}</div>\n\t\t<div className=\"Button\" style={{background: color.hex}} onClick={toggleBulb}>\n\t\t\t<img className=\"ButtonImage\" src={light.Status ? bulb : offbulb }></img>\n\t\t</div>\n\t\t{ light.Status ?  \n\t\t\t!patternMode ?\n\t\t\t\t<>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<HuePicker className=\"ButtonImage\" color={color.hsl} onChangeComplete={(c) => onColorChange(false, c)}/>\n\t\t\t\t\t<br/>\n                \t\t\t<AlphaPicker className=\"ButtonImage\" color={color.hsl} onChangeComplete={(c) => onColorChange(true, c)}/>\n\t\t\t\t</>\n\t\t\t:\n\t\t\t<DropdownButton\n\t\t\t\tdrop={'up'}\n\t\t\t\tvariant=\"secondary\"\n\t\t\t\ttitle={\"Select Pattern\"}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tonSelect={dropDown}\n\t\t\t\tclassName=\"PatternPicker\"\n\t\t\t>\n\t\t\t\t<Dropdown.Item eventKey=\"christmas\">Settings</Dropdown.Item>\n\t\t\t\t<Dropdown.Item eventKey=\"easter\">Easter</Dropdown.Item>\n\t\t\t</DropdownButton>\n\t\t: \n\t\t\t<></>\n\t\t}\n\n\t</div>\n  \t);\n}\n\n\nexport default Picker2;\n"]},"metadata":{},"sourceType":"module"}