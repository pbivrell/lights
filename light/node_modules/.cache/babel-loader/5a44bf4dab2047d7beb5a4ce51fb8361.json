{"ast":null,"code":"import _slicedToArray from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../App.css';import Button from\"react-bootstrap/Button\";import React,{useState}from\"react\";import LightsDetect from\"../components/LightDetect\";import LightsIP from\"../components/LightIP\";import{RgbColorPicker}from\"react-colorful\";import axios from\"axios\";import Spinner from\"react-bootstrap/Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Picker(_ref){var lightData=_ref.lightData,lights=_ref.lights;var _useState=useState({r:200,g:150,b:35}),_useState2=_slicedToArray(_useState,2),color=_useState2[0],setColor=_useState2[1];//const [ip, setIP] = useState({ ip: \"192.168.86.162\", pixels: 50 });\nvar last=Date.now();function onColorChange(color){var now=Date.now();console.log(color);if(now-last<100){console.log(\"ignoring time\");return;}last=now;setColor(color);console.log(lightData);console.log(lights);console.log(lights.lights);if(!lights||!lights.lights||!lightData){return;}lights.lights.forEach(function(light){console.log(\"looping\",light);var data=generateBinary(color,lightData.lights[light].pixels);var blob=new Blob([data],{type:\"application/octet-stream\"});var bodyFormData=new FormData();bodyFormData.append(\"file\",blob,\"dummy.bin\");axios({method:\"post\",url:\"http://\".concat(lightData.lights[light].ip,\"/upload\"),data:bodyFormData,headers:{\"Content-Type\":\"multipart/form-data\"}}).then(function(response){//handle success\nconsole.log(response);}).catch(function(response){//handle error\nconsole.log(response);});});//axios.get(`http://${ip}/color?r=${color.r}&g=${color.g}&b=${color.b}`).catch((resp) => {\n//\tconsole.log(\"TODO\")\n//});\n}function generateBinary(color,pixels){var data=new Uint8Array((2+pixels)*8);var bytes=getInt64Bytes(pixels);var count=bytes[bytes.length-2]<<8|bytes[bytes.length-1];data[0]=0x3;data[1]=bytes[bytes.length-1];data[2]=bytes[bytes.length-2];for(var i=0;i<pixels;i++){var _bytes=getInt64Bytes(i);data[(i+1)*8]=0x1;data[(i+1)*8+1]=color.r;data[(i+1)*8+2]=color.g;data[(i+1)*8+3]=color.b;data[(i+1)*8+4]=_bytes[_bytes.length-1];data[(i+1)*8+5]=_bytes[_bytes.length-2];}data[8+pixels*8]=0x2;data[8+pixels*8+1]=200;data[8+pixels*8+2]=0;data[8+pixels*8+3]=0;data[8+pixels*8+4]=0;console.log(data);return data;}function getInt64Bytes(x){var y=Math.floor(x/Math.pow(2,32));return[y,y<<8,y<<16,y<<24,x,x<<8,x<<16,x<<24].map(function(z){return z>>>24;});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(RgbColorPicker,{color:color,onChange:onColorChange}),/*#__PURE__*/_jsxs(\"p\",{children:[color.r,\", \",color.g,\", \",color.b]})]});}export default Picker;","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/components/Picker.js"],"names":["Button","React","useState","LightsDetect","LightsIP","RgbColorPicker","axios","Spinner","Picker","lightData","lights","r","g","b","color","setColor","last","Date","now","onColorChange","console","log","forEach","light","data","generateBinary","pixels","blob","Blob","type","bodyFormData","FormData","append","method","url","ip","headers","then","response","catch","Uint8Array","bytes","getInt64Bytes","count","length","i","x","y","Math","floor","map","z"],"mappings":"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","sourcesContent":["import '../App.css';\nimport Button from \"react-bootstrap/Button\";\nimport React, { useState } from \"react\";\nimport LightsDetect from \"../components/LightDetect\";\nimport LightsIP from \"../components/LightIP\";\nimport { RgbColorPicker } from \"react-colorful\";\nimport axios from \"axios\";\nimport Spinner from \"react-bootstrap/Spinner\";\n\nfunction Picker({lightData, lights}) {\n\n  \tconst [color, setColor] = useState({ r: 200, g: 150, b: 35 });\n\t//const [ip, setIP] = useState({ ip: \"192.168.86.162\", pixels: 50 });\n\n\tvar last = Date.now();\n\tfunction onColorChange(color) {\n\n\t\tlet now = Date.now();\n\t\tconsole.log(color);\n\t\tif (now - last < 100) {\n\t\t\tconsole.log(\"ignoring time\");\n\t\t\treturn;\n\t\t}\n\t\tlast = now;\n\t\tsetColor(color);\n\t\t\n\t\n\t\tconsole.log(lightData);\n\t\tconsole.log(lights);\n\t\tconsole.log(lights.lights);\n\t\t\n\t\tif (!lights || !lights.lights || !lightData) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlights.lights.forEach((light) => {\n\t\t\tconsole.log(\"looping\", light);\n\t\t\tlet data = generateBinary(color, lightData.lights[light].pixels);\n                \tlet blob = new Blob([data], {type: \"application/octet-stream\"});\n\t\t\tlet bodyFormData = new FormData();\n                \tbodyFormData.append(\"file\", blob, \"dummy.bin\");\n\n                \taxios({\n                \t\tmethod: \"post\",\n                \t\turl: `http://${lightData.lights[light].ip}/upload`,\n                \t\tdata: bodyFormData,\n                \t\theaders: { \"Content-Type\": \"multipart/form-data\" },\n                \t})\n                \t.then(function (response) {\n                \t\t//handle success\n                \t\tconsole.log(response);\n                \t})\n                \t.catch(function (response) {\n                \t\t//handle error\n                \t\tconsole.log(response);\n                \t});\n\t\t});\n\n\t\t//axios.get(`http://${ip}/color?r=${color.r}&g=${color.g}&b=${color.b}`).catch((resp) => {\n\t\t//\tconsole.log(\"TODO\")\n                //});\n\t}\n\t\n\t\n\tfunction generateBinary(color, pixels) {\n\t\t\n\t\tlet data = new Uint8Array((2 + pixels) * 8);\n\t\tlet bytes = getInt64Bytes(pixels);\n\n\t\tlet count = (bytes[bytes.length-2] << 8) | bytes[bytes.length-1];\n\t\t\n\t\tdata[0] = 0x3;\n\t\tdata[1] = bytes[bytes.length-1];\n\t\tdata[2] = bytes[bytes.length-2];\n\n\t\tfor (let i = 0; i < pixels; i++) {\n\t\t\tlet bytes = getInt64Bytes(i);\n\t\t \tdata[(i + 1) * 8] = 0x1;\n\t\t\tdata[(i + 1) * 8 + 1] = color.r;\n\t\t\tdata[(i + 1) * 8 + 2] = color.g;\n\t\t\tdata[(i + 1) * 8 + 3] = color.b;\n\t\t\tdata[(i + 1) * 8 + 4] = bytes[bytes.length-1];\n\t\t\tdata[(i + 1) * 8 + 5] = bytes[bytes.length-2];\n\t\t}\n\n\t\tdata[8 + (pixels * 8)] = 0x2;\n\t\tdata[8 + (pixels * 8) + 1] = 200;\n\t\tdata[8 + (pixels * 8) + 2] = 0;\n\t\tdata[8 + (pixels * 8) + 3] = 0;\n\t\tdata[8 + (pixels * 8) + 4] = 0;\n\n\n\t\tconsole.log(data);\n\t\treturn data;\n\n\t}\n\n\tfunction getInt64Bytes(x) {\n  \t\tlet y= Math.floor(x/2**32);\n  \t\treturn [y,(y<<8),(y<<16),(y<<24), x,(x<<8),(x<<16),(x<<24)].map(z=> z>>>24)\n\t}\n\n\treturn (\n\t<div>\n            <RgbColorPicker color={color} onChange={onColorChange} />\n            <p>{ color.r}, {color.g}, {color.b}</p>\n\t</div>\n  \t);\n}\n\n\nexport default Picker;\n"]},"metadata":{},"sourceType":"module"}