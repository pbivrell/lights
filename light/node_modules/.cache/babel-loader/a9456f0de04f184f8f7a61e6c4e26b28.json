{"ast":null,"code":"import _objectSpread from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/pbivrell/light/light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'./Picker2.css';import React,{useState,useEffect}from\"react\";import{HuePicker,AlphaPicker}from'react-color';import bulb from'../res/Bulb_crop.png';import offbulb from'../res/OffBulb_crop.png';import disconnectedbulb from'../res/DisconnectedBulb_crop.png';import axios from\"axios\";import{displayError}from\"../lib/hooks\";import LightSettings from'../containers/lightsettings.js';import{ToggleButton,ToggleButtonGroup,DropdownButton,Dropdown,ListGroup}from\"react-bootstrap\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Picker2(_ref){var name=_ref.name,hub=_ref.hub;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),settings=_useState2[0],setSettings=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),light=_useState4[0],setLight=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),patternMode=_useState6[0],setPatternMode=_useState6[1];useEffect(function(){getLight();},[]);var _useState7=useState({hsl:{a:1},rgb:{a:1},hex:\"\"}),_useState8=_slicedToArray(_useState7,2),color=_useState8[0],setColor=_useState8[1];function settingsCallback(){setSettings(false);getLight();}function getLight(){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/user/hub/\").concat(hub,\"/light/\").concat(name),{withCredentials:true}).then(function(resp){setLight(resp.data);var pattern=resp.data.PatternID.split(\"~\")[1].split(\".\")[0].split(\"-\");console.log(pattern);setColor({rgb:{r:pattern[0],g:pattern[1],b:pattern[2],a:pattern[3]/100},hex:\"rgba(\".concat(pattern[0],\",\").concat(pattern[1],\",\").concat(pattern[2],\",\").concat(pattern[3]/100),hsl:{a:pattern[3]/100}});}).catch(function(e){displayError(e);});}/*function pushLight(pushColor) {\n\t\tlet data = generateBinary(pushColor, light.Count);\n                let blob = new Blob([data], {type: \"application/octet-stream\"});\n                let bodyFormData = new FormData();\n                bodyFormData.append(\"file\", blob, `${pushColor.r}-${pushColor.g}-${pushColor.b}-${pushColor.a}.bin`);\n\n                axios({\n                \tmethod: \"post\",\n                \turl: `http://${light.IP}/upload`,\n                \tdata: bodyFormData,\n                \theaders: { \"Content-Type\": \"multipart/form-data\" },\n                })\n                .then(function (response) {\n                \tconsole.log(response);\n                })\n                .catch(function (response) {\n                \tdisplayError(response)\n                });\n\t}*/function pushLight(pushColor){axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/user/hub/\").concat(hub,\"/light/\").concat(name),{PatternID:\"~\".concat(pushColor.r,\"-\").concat(pushColor.g,\"-\").concat(pushColor.b,\"-\").concat(Math.floor(pushColor.a*100),\".bin\")},{withCredentials:true}).then(function(resp){console.log(\"toggled\");}).catch(function(e){displayError(e);});}function pushToggle(s){axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/user/hub/\").concat(hub,\"/light/\").concat(name),{Status:s},{withCredentials:true}).then(function(resp){console.log(\"toggled\");}).catch(function(e){displayError(e);});}function toggleBulb(){var map=_objectSpread({},light);map.Status=!map.Status;setLight(map);pushToggle(map.Status);}function onColorChange(hue,c){console.log(c);var hsl=c.hsl;var rgb=c.rgb;if(!hue){hsl.a=color.hsl.a;rgb.a=color.rgb.a;}setColor({hsl:hsl,rgb:c.rgb,hex:\"rgba(\".concat(c.rgb.r,\",\").concat(c.rgb.g,\",\").concat(c.rgb.b,\",\").concat(hsl.a)});pushLight(c.rgb);}function generateBinary(color,pixels){var data=new Uint8Array((2+pixels)*8);var bytes=getInt64Bytes(pixels);var count=bytes[bytes.length-2]<<8|bytes[bytes.length-1];data[0]=0x3;data[1]=bytes[bytes.length-1];data[2]=bytes[bytes.length-2];for(var i=0;i<pixels;i++){var _bytes=getInt64Bytes(i);data[(i+1)*8]=0x1;data[(i+1)*8+1]=parseInt(color.r*color.a);data[(i+1)*8+2]=parseInt(color.g*color.a);data[(i+1)*8+3]=parseInt(color.b*color.a);data[(i+1)*8+4]=_bytes[_bytes.length-1];data[(i+1)*8+5]=_bytes[_bytes.length-2];}data[8+pixels*8]=0x2;data[8+pixels*8+1]=200;data[8+pixels*8+2]=0;data[8+pixels*8+3]=0;data[8+pixels*8+4]=0;console.log(data);return data;}function getInt64Bytes(x){var y=Math.floor(x/Math.pow(2,32));return[y,y<<8,y<<16,y<<24,x,x<<8,x<<16,x<<24].map(function(z){return z>>>24;});}function dropDown(e){console.log(\"Dropdown\",e);}function renderSettings(){return/*#__PURE__*/_jsx(\"div\",{className:\"Popup Auth\",children:/*#__PURE__*/_jsx(LightSettings,{light:light,hub:hub,callback:settingsCallback})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"Picker\",children:[settings?renderSettings():/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(\"div\",{className:\"ButtonText\",onClick:function onClick(){return setSettings(!settings);},children:light.Alias===\"\"?light.ID:light.Alias}),/*#__PURE__*/_jsx(\"div\",{className:\"Button\",style:{background:color.hex},onClick:toggleBulb,children:/*#__PURE__*/_jsx(\"img\",{className:\"ButtonImage\",src:light.Status?bulb:offbulb})}),light.Status?!patternMode?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(HuePicker,{className:\"ButtonImage\",color:color.hsl,onChangeComplete:function onChangeComplete(c){return onColorChange(false,c);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(AlphaPicker,{className:\"ButtonImage\",color:color.hsl,onChangeComplete:function onChangeComplete(c){return onColorChange(true,c);}})]}):/*#__PURE__*/_jsxs(DropdownButton,{drop:'up',variant:\"secondary\",title:\"Select Pattern\",size:\"sm\",onSelect:dropDown,className:\"PatternPicker\",children:[/*#__PURE__*/_jsx(Dropdown.Item,{eventKey:\"christmas\",children:\"Christmas\"}),/*#__PURE__*/_jsx(Dropdown.Item,{eventKey:\"easter\",children:\"Easter\"})]}):/*#__PURE__*/_jsx(_Fragment,{})]});}export default Picker2;","map":{"version":3,"sources":["/Users/pbivrell/light/light/src/components/Picker2.js"],"names":["React","useState","useEffect","HuePicker","AlphaPicker","bulb","offbulb","disconnectedbulb","axios","displayError","LightSettings","ToggleButton","ToggleButtonGroup","DropdownButton","Dropdown","ListGroup","Picker2","name","hub","settings","setSettings","light","setLight","patternMode","setPatternMode","getLight","hsl","a","rgb","hex","color","setColor","settingsCallback","get","process","env","REACT_APP_API_URL","withCredentials","then","resp","data","pattern","PatternID","split","console","log","r","g","b","catch","e","pushLight","pushColor","post","Math","floor","pushToggle","s","Status","toggleBulb","map","onColorChange","hue","c","generateBinary","pixels","Uint8Array","bytes","getInt64Bytes","count","length","i","parseInt","x","y","z","dropDown","renderSettings","Alias","ID","background"],"mappings":"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","sourcesContent":["import './Picker2.css';\nimport React, { useState, useEffect } from \"react\";\nimport { HuePicker, AlphaPicker } from 'react-color'\nimport bulb from '../res/Bulb_crop.png';\nimport offbulb from '../res/OffBulb_crop.png';\nimport disconnectedbulb from '../res/DisconnectedBulb_crop.png';\nimport axios from \"axios\";\nimport {displayError} from \"../lib/hooks\";\nimport LightSettings from '../containers/lightsettings.js';\nimport {ToggleButton, ToggleButtonGroup, DropdownButton, Dropdown, ListGroup} from \"react-bootstrap\";\n\nfunction Picker2({name, hub}) {\n\n\tconst [settings, setSettings] = useState(false);\n\tconst [light, setLight] = useState({});\n\tconst [patternMode, setPatternMode] = useState(true);\n\n\tuseEffect(() => {\n\t\tgetLight();\n\t}, [])\n\n\n  \tconst [color, setColor] = useState({ hsl: {a: 1}, rgb: {a: 1}, hex: \"\"});\n\t\n\tfunction settingsCallback() {\n\t\tsetSettings(false);\n\t\tgetLight();\n\t}\n\n\tfunction getLight() {\n\t\t\n\t\taxios.get(`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, {\n\t\t\twithCredentials: true,\n\t\t}).then((resp) => {\n\t\t\tsetLight(resp.data);\n\t\t\tlet pattern = resp.data.PatternID.split(\"~\")[1].split(\".\")[0].split(\"-\");\n\t\t\tconsole.log(pattern);\n\t\t\tsetColor({\n\t\t\t\trgb: {r: pattern[0], g: pattern[1], b: pattern[2], a: pattern[3]/100},\n\t\t\t\thex: `rgba(${pattern[0]},${pattern[1]},${pattern[2]},${pattern[3]/100}`,\n\t\t\t\thsl: {a: pattern[3]/100},\n\n\t\t\t});\n\t\t}).catch((e) => {\n\t\t\tdisplayError(e);\n\t\t});\n\t}\n\n\t/*function pushLight(pushColor) {\n\t\tlet data = generateBinary(pushColor, light.Count);\n                let blob = new Blob([data], {type: \"application/octet-stream\"});\n                let bodyFormData = new FormData();\n                bodyFormData.append(\"file\", blob, `${pushColor.r}-${pushColor.g}-${pushColor.b}-${pushColor.a}.bin`);\n\n                axios({\n                \tmethod: \"post\",\n                \turl: `http://${light.IP}/upload`,\n                \tdata: bodyFormData,\n                \theaders: { \"Content-Type\": \"multipart/form-data\" },\n                })\n                .then(function (response) {\n                \tconsole.log(response);\n                })\n                .catch(function (response) {\n                \tdisplayError(response)\n                });\n\t}*/\n\n\tfunction pushLight(pushColor) {\n\t\taxios.post(\n\t\t\t`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`, \n\t\t\t{ PatternID: `~${pushColor.r}-${pushColor.g}-${pushColor.b}-${Math.floor(pushColor.a * 100)}.bin` }, \n\t\t\t{withCredentials: true,}\n\t\t)\n\t\t.then((resp) => {\n\t\t\tconsole.log(\"toggled\");\n\t\t})\n\t\t.catch((e) => {\n        \t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction pushToggle(s) {\n\t\taxios.post(\n\t\t\t`${process.env.REACT_APP_API_URL}/user/hub/${hub}/light/${name}`,\n\t\t\t{Status: s}, \n\t\t\t{withCredentials: true,}\n\t\t)\n\t\t.then((resp) => {\n\t\t\tconsole.log(\"toggled\");\n\t\t})\n\t\t.catch((e) => {\n        \t\tdisplayError(e);\n\t\t});\n\t}\n\n\tfunction toggleBulb() {\n\t\tconst map = {...light};\n                map.Status = !map.Status;\n                setLight(map);\n\t\tpushToggle(map.Status);\n\t}\n\n\tfunction onColorChange(hue, c) {\n\n\t\tconsole.log(c);\n\n\t\tlet hsl = c.hsl;\n\t\tlet rgb = c.rgb;\n\n\t\tif(!hue) {\n\t\t\thsl.a = color.hsl.a;\n\t\t\trgb.a = color.rgb.a;\n\t\t}\n\t\tsetColor({hsl: hsl, rgb: c.rgb, hex: `rgba(${c.rgb.r},${c.rgb.g},${c.rgb.b},${hsl.a}`});\n\t\t\n\t\tpushLight(c.rgb);\n\t}\n\t\n\t\n\tfunction generateBinary(color, pixels) {\n\t\t\n\t\tlet data = new Uint8Array((2 + pixels) * 8);\n\t\tlet bytes = getInt64Bytes(pixels);\n\n\t\tlet count = (bytes[bytes.length-2] << 8) | bytes[bytes.length-1];\n\t\t\n\t\tdata[0] = 0x3;\n\t\tdata[1] = bytes[bytes.length-1];\n\t\tdata[2] = bytes[bytes.length-2];\n\n\t\tfor (let i = 0; i < pixels; i++) {\n\t\t\tlet bytes = getInt64Bytes(i);\n\t\t \tdata[(i + 1) * 8] = 0x1;\n\t\t\tdata[(i + 1) * 8 + 1] = parseInt(color.r * color.a) ;\n\t\t\tdata[(i + 1) * 8 + 2] = parseInt(color.g * color.a);\n\t\t\tdata[(i + 1) * 8 + 3] = parseInt(color.b * color.a);\n\t\t\tdata[(i + 1) * 8 + 4] = bytes[bytes.length-1];\n\t\t\tdata[(i + 1) * 8 + 5] = bytes[bytes.length-2];\n\t\t}\n\n\t\tdata[8 + (pixels * 8)] = 0x2;\n\t\tdata[8 + (pixels * 8) + 1] = 200;\n\t\tdata[8 + (pixels * 8) + 2] = 0;\n\t\tdata[8 + (pixels * 8) + 3] = 0;\n\t\tdata[8 + (pixels * 8) + 4] = 0;\n\n\n\t\tconsole.log(data);\n\t\treturn data;\n\n\t}\n\n\tfunction getInt64Bytes(x) {\n  \t\tlet y= Math.floor(x/2**32);\n  \t\treturn [y,(y<<8),(y<<16),(y<<24), x,(x<<8),(x<<16),(x<<24)].map(z=> z>>>24)\n\t}\n\n\tfunction dropDown(e) {\n\t\tconsole.log(\"Dropdown\", e);\n\t}\n\n\tfunction renderSettings() {\n\t\treturn (\n\t\t\t<div className=\"Popup Auth\">\n\t\t\t\t<LightSettings light={light} hub={hub} callback={settingsCallback}/>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t<div className=\"Picker\">\n\t\t{ settings ? renderSettings() : <></>}\n\n\t\t<div className=\"ButtonText\" onClick={()=>setSettings(!settings)}>{light.Alias === \"\" ? light.ID : light.Alias}</div>\n\t\t<div className=\"Button\" style={{background: color.hex}} onClick={toggleBulb}>\n\t\t\t<img className=\"ButtonImage\" src={light.Status ? bulb : offbulb }></img>\n\t\t</div>\n\t\t{ light.Status ?  \n\t\t\t!patternMode ?\n\t\t\t\t<>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<HuePicker className=\"ButtonImage\" color={color.hsl} onChangeComplete={(c) => onColorChange(false, c)}/>\n\t\t\t\t\t<br/>\n                \t\t\t<AlphaPicker className=\"ButtonImage\" color={color.hsl} onChangeComplete={(c) => onColorChange(true, c)}/>\n\t\t\t\t</>\n\t\t\t:\n\t\t\t<DropdownButton\n\t\t\t\tdrop={'up'}\n\t\t\t\tvariant=\"secondary\"\n\t\t\t\ttitle={\"Select Pattern\"}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tonSelect={dropDown}\n\t\t\t\tclassName=\"PatternPicker\"\n\t\t\t>\n\t\t\t\t<Dropdown.Item eventKey=\"christmas\">Christmas</Dropdown.Item>\n\t\t\t\t<Dropdown.Item eventKey=\"easter\">Easter</Dropdown.Item>\n\t\t\t</DropdownButton>\n\t\t: \n\t\t\t<></>\n\t\t}\n\n\t</div>\n  \t);\n}\n\n\nexport default Picker2;\n"]},"metadata":{},"sourceType":"module"}